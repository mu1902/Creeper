import datetime
import sys

import numpy as np
import pandas as pd
from WindPy import w


if __name__ == '__main__':
    fund_list = '519991.OF,260112.OF,180010.OF,519035.OF,002001.OF,000940.OF,166005.OF,000966.OF,005739.OF,000259.OF,420005.OF,110001.OF,003567.OF,163804.OF,210005.OF,590005.OF,001468.OF,000577.OF,001662.OF,270007.OF,519127.OF,519150.OF,000214.OF,580002.OF,000689.OF,163402.OF,000001.OF,377240.OF,002334.OF,002335.OF,110015.OF,660012.OF,270002.OF,501000.OF,470008.OF,001910.OF,217009.OF,001424.OF,001425.OF,050014.OF,481001.OF,000309.OF,001802.OF,001803.OF,070099.OF,001219.OF,161903.OF,161616.OF,004763.OF,004764.OF,519068.OF,000978.OF,090015.OF,519099.OF,050004.OF,270028.OF,160322.OF,100020.OF,206009.OF,002778.OF,002779.OF,255010.OF,162703.OF,377020.OF,005358.OF,005359.OF,260103.OF,229002.OF,260108.OF,001323.OF,519678.OF,460007.OF,580001.OF,519029.OF,000711.OF,420001.OF,001405.OF,001406.OF,040020.OF,519018.OF,519644.OF,000803.OF,001280.OF,160314.OF,373010.OF,000136.OF,501001.OF,000172.OF,167702.OF,167703.OF,040005.OF,519670.OF,166009.OF,001869.OF,001043.OF,001256.OF,090009.OF,005275.OF,005276.OF,000423.OF,481008.OF,001105.OF,160512.OF,519011.OF,166011.OF,257020.OF,100056.OF,360006.OF,217012.OF,162207.OF,002148.OF,160613.OF,420003.OF,110022.OF,150016.OF,150017.OF,163406.OF,450001.OF,005588.OF,005592.OF,762001.OF,260111.OF,530019.OF,000251.OF,002694.OF,320003.OF,200008.OF,003030.OF,003031.OF,001195.OF,000893.OF,519125.OF,530003.OF,001682.OF,002952.OF,519987.OF,004119.OF,260116.OF,000029.OF,006511.OF,006512.OF,005847.OF,165516.OF,000566.OF,110011.OF,001672.OF,002134.OF,001441.OF,001442.OF,001466.OF,001467.OF,519679.OF,004183.OF,080002.OF,450009.OF,001192.OF,000209.OF,001513.OF,000021.OF,002015.OF,002016.OF,288002.OF,630008.OF,160215.OF,166002.OF,571002.OF,161005.OF,001399.OF,001400.OF,005628.OF,005629.OF,257010.OF'

    w.start()

    for i in range(1, 11):
        funds_stocks = w.wss(fund_list, "prt_topstockwindcode,prt_topstockname,prt_topproportiontofloating,prt_heavilyheldstocktonav,prt_fundnoofstocks", "rptDate=20190630;order="+str(i))
        if funds_stocks.ErrorCode != 0:
            print(funds_stocks.Data)
            sys.exit(0)
        if i == 1:
            funds_stocks_df = pd.DataFrame(funds_stocks.Data, index=funds_stocks.Fields,
                                           columns=funds_stocks.Codes).T
        else:
            funds_stocks_df = funds_stocks_df.append(pd.DataFrame(funds_stocks.Data, index=funds_stocks.Fields,
                                                                  columns=funds_stocks.Codes).T)
    funds_stocks_df = funds_stocks_df.sort_index()

    w.stop()

    writer = pd.ExcelWriter('mngr.xlsx')
    funds_stocks_df.to_excel(writer, sheet_name='funds')
    writer.save()
